"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[3510],{11827:(e,t,s)=>{s.d(t,{A:()=>r});s(9950);var a=s(35887),o=s(58549),i=s(44414);const r=function(e){let{closeModal:t,onSuccess:s}=e;return(0,i.jsx)("div",{className:"",children:(0,i.jsx)("div",{"data-aos":"fade-up","data-aos-duration":"1000","data-aos-delay":"100","data-aos-offset":"200",className:" bg-white px-6",children:(0,i.jsx)(o.A,{titles:!0,isModal:!0,onSave:async e=>{try{const t=await fetch("".concat("","/doctor/patients/create"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),o=await t.json();t.ok?(a.oR.success(o.message||"Patient created successfully!"),s&&s(o.data||e)):a.oR.error((null===o||void 0===o?void 0:o.message)||"Failed to create patient")}catch(t){console.error(t),a.oR.error("Something went wrong. Please try again.")}},closeModal:t})})})}},38205:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(39174),o=s(28429),i=s(44414);const r=function(e){let{onActionClick:t}=e;const s={"/patients":"Add Patient","/appointments":"New Appointment","/payments":"Add Payment","/services":"Add Service"}[(0,o.zy)().pathname];return s?(0,i.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-[#0095D9] to-[#0078B3] text-white font-medium hover:shadow-lg transform hover:scale-105 transition-all duration-200",title:s,children:[(0,i.jsx)(a.Ca6,{className:"text-lg"}),(0,i.jsx)("span",{className:"text-sm",children:s})]}):null}},38968:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=s(9950),o=s(35887),i=s(39174),r=s(17340),l=s(38613),n=s(61533),c=s(22535),d=s(58644),u=s(99324),v=s(44414);const x=function(e){let{closeModal:t,isOpen:s,datas:i,onServiceUpdated:r}=e;const[n,c]=(0,a.useState)("Consultant"),[x,p]=(0,a.useState)(500),[m,h]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1),y=i&&(i._id||i.id),w=i&&i.isDefault;return(0,a.useEffect)(()=>{y&&i&&(i._id||i.id)?(c(i.serviceName||i.name||""),p(i.price||0),h(i.description||""),f(!i.isDisabled)):(c("Consultant"),p(500),h(""),f(!1))},[i,y]),(0,a.useEffect)(()=>{s&&!y&&(c("Consultant"),p(500),h(""),f(!1))},[s,y]),(0,v.jsx)(d.A,{closeModal:t,isOpen:s,title:y?w?"Default Service ":"Service":"New Service",width:"max-w-3xl",children:(0,v.jsxs)("div",{className:"flex-colo gap-4",children:[w&&(0,v.jsx)("div",{className:"w-full rounded-lg bg-blue-50 p-3 text-sm text-blue-700",children:(0,v.jsx)("p",{children:"\u26a0\ufe0f This is a default service. Click on Save to add this service."})}),(0,v.jsx)(l.pd,{label:"Service Name",color:!0,value:n,onChange:e=>c(e.target.value),placeholder:"Enter service name"}),(0,v.jsx)(l.pd,{label:"Price (Tsh)",type:"number",color:!0,value:x,onChange:e=>p(Number(e.target.value)),placeholder:"Enter price"}),(0,v.jsx)(l.TM,{label:"Description",value:m,onChange:e=>h(e.target.value),placeholder:"Write description here...",color:!0,rows:4}),(0,v.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,v.jsx)(l.kT,{label:"Status",checked:g,onChange:()=>f(!g)}),(0,v.jsx)("p",{className:"text-sm ".concat(g?"text-subMain":"text-textGray"),children:g?"Enabled":"Disabled"})]}),(0,v.jsxs)("div",{className:"grid w-full gap-3 sm:grid-cols-2",children:[(0,v.jsx)("button",{onClick:t,disabled:b,className:"rounded-lg bg-red-600 bg-opacity-5 px-3 py-2 text-sm font-light text-red-600 disabled:opacity-50",children:y?"Discard":"Cancel"}),(0,v.jsx)(l.$n,{label:b?"Saving...":"Save",Icon:u.CU3,onClick:async()=>{if(!n||x<=0)return o.oR.error("Please fill all required fields correctly."),void console.warn("Validation failed:",{serviceName:n,price:x});j(!0);try{const e={serviceName:n,price:x,description:m,isDisabled:!g};let s,a;if(console.log("Prepared serviceData:",e),y&&w){const s="".concat("","/doctor/services/create");console.log("Converting default service to real service...");const a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(a.ok){await a.json();return o.oR.success("Service added successfully!"),t(),void(r&&r())}{await a.text();const e="Failed to save service.";return void o.oR.error(e)}}if(y){const t=i._id||i.id;a="".concat("","/doctor/services/edit/").concat(t),console.log("Sending PUT request to:",a),s=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})}else a="".concat("","/doctor/services/create"),console.log("Sending POST request to:",a),s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(s){console.log("Raw response status:",s.status);const e=s.headers.get("content-type");console.log("Response content-type:",e);const a=null!==e&&void 0!==e&&e.includes("application/json")?await s.json():await s.text();if(console.log("Parsed response:",a),s.ok)o.oR.success(y?"Service updated successfully!":"Service created successfully!"),t(),r&&r();else{const e="object"===typeof a&&a.message?a.message:"Failed to save service.";o.oR.error(e)}}}catch(e){console.error("Error saving service:",e),o.oR.error("Something went wrong.")}finally{j(!1)}},disabled:b})]})]})})};var p=s(28429),m=s(11827),h=s(38205);const g=function(){const[e,t]=a.useState(!1),[s,u]=a.useState({}),[g,f]=a.useState(c.rQ.service[0]),[b,j]=(0,a.useState)([]),[y,w]=(0,a.useState)(""),[S,N]=(0,a.useState)([]),[C,A]=(0,a.useState)(!0),[P,D]=(0,a.useState)([]),[T,k]=(0,a.useState)(""),[M,E]=(0,a.useState)(!1),[O,R]=(0,a.useState)(!1),L=(0,p.Zp)(),F=()=>({_id:"default-consultation",serviceName:"Consultation",price:500,createdAt:(new Date).toISOString(),isDisabled:!0,isDefault:!0}),U=async()=>{try{A(!0);const e=await fetch("".concat("","/doctor/services"),{credentials:"include"});if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));const t=await e.json(),s=Array.isArray(t)?t:Array.isArray(null===t||void 0===t?void 0:t.services)?t.services:[];0===s.length?j([F()]):j(s)}catch(e){console.log("error fetching...",e),o.oR.error("Failed to fetch services"),j([F()])}finally{A(!1)}};(0,a.useEffect)(()=>{let e=[...b];"enabled"===(null===g||void 0===g?void 0:g.value)?e=e.filter(e=>!e.isDisabled):"disabled"===(null===g||void 0===g?void 0:g.value)&&(e=e.filter(e=>e.isDisabled)),y.trim()&&(e=e.filter(e=>{var t;return null===(t=e.serviceName)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase())})),N(e)},[b,y,g]),(0,a.useEffect)(()=>{U()},[]);const _=async()=>{try{const e=await fetch("".concat("","/doctor/patients"),{credentials:"include"}),t=await e.json();D(t||[])}catch(e){console.log("Error fetching patients:",e)}};(0,a.useEffect)(()=>{_()},[]),(0,a.useEffect)(()=>{const e=()=>{q()};return window.addEventListener("action:addService",e),()=>{window.removeEventListener("action:addService",e)}},[]);const J=null===P||void 0===P?void 0:P.filter(e=>((null===e||void 0===e?void 0:e.title)||"").toLowerCase().includes(T.toLowerCase())),q=()=>{u({}),t(!0)};return C?(0,v.jsx)(r.A,{children:(0,v.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,v.jsxs)("div",{className:"text-center",children:[(0,v.jsx)("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-b-2 border-subMain"}),(0,v.jsx)("p",{children:"Loading services..."})]})})}):(0,v.jsxs)(r.A,{children:[e&&(0,v.jsx)(x,{datas:s,isOpen:e,closeModal:()=>{t(!1),u({})},onServiceUpdated:()=>{U()}}),(0,v.jsxs)("div",{className:"relative mb-6 grid grid-cols-1 gap-2 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-7",children:[(0,v.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Services"}),M&&T&&(0,v.jsxs)("ul",{className:"absolute top-16 z-10 w-full max-w-xs rounded-md border border-gray-200 bg-white shadow-md md:col-span-2 lg:col-span-3",children:[(null===J||void 0===J?void 0:J.length)>0&&J.map((e,t)=>(0,v.jsxs)("li",{className:"flex cursor-pointer flex-row items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onMouseDown:t=>{t.preventDefault(),k((null===e||void 0===e?void 0:e.title)||""),E(!1),L("/patients/preview/".concat(null===e||void 0===e?void 0:e._id))},children:[(0,v.jsx)("img",{src:null===e||void 0===e?void 0:e.image,alt:"Patient",className:"h-10 w-10 rounded-full border border-subMain object-cover"}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)("h2",{className:"text-sm font-semibold",children:null===e||void 0===e?void 0:e.title}),(0,v.jsx)("p",{className:"text-xs text-textGray",children:null===e||void 0===e?void 0:e.email}),(0,v.jsx)("p",{className:"text-xs",children:null===e||void 0===e?void 0:e.phone})]})]},t)),0===(null===J||void 0===J?void 0:J.length)&&(0,v.jsxs)("li",{className:"flex cursor-pointer items-center gap-2 px-4 py-2 text-sm text-main hover:bg-gray-100",onMouseDown:e=>{e.preventDefault(),R(!0)},children:[(0,v.jsx)("span",{className:"text-xl font-bold",children:"+"}),(0,v.jsxs)("span",{children:['Add "',T,'" as new patient']})]})]})]}),(0,v.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,v.jsx)("input",{type:"text",placeholder:'Search "Patients"',className:"h-11 rounded-md border border-border bg-dry px-4 text-sm text-main md:col-span-2 lg:col-span-3",value:T,onChange:e=>{k(e.target.value),E(!0)},onBlur:()=>{setTimeout(()=>E(!1),150)},onFocus:()=>E(!0)}),(0,v.jsx)(h.A,{onActionClick:q})]}),(0,v.jsxs)("div",{"data-aos":"fade-up","data-aos-duration":"1000","data-aos-delay":"100","data-aos-offset":"200",className:"my-8 rounded-xl border-[1px] border-border bg-white p-5",children:[(0,v.jsx)("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-6",children:(0,v.jsxs)("div",{className:"grid items-center gap-6 xs:grid-cols-2 md:col-span-5 lg:grid-cols-4",children:[(0,v.jsx)("input",{type:"text",placeholder:'Search "teeth cleaning"',className:"h-[42px] w-full rounded-md border border-border bg-dry p-[10px] text-sm text-main focus:border-subMain focus:outline-none",value:y,onChange:e=>w(e.target.value)}),(0,v.jsx)(l.gT,{selectedPerson:g,setSelectedPerson:f,datas:c.rQ.service,children:(0,v.jsxs)("div",{className:"flex-btn mt-[5px] w-[100px] rounded-lg border border-border bg-dry p-[10px] text-sm font-light text-main transition-colors hover:border-subMain focus:border focus:border-subMain",children:[g.name," ",(0,v.jsx)(i.nwe,{className:"text-xl"})]})})]})}),(0,v.jsx)("div",{className:"mt-8 w-full",children:0===S.length?(0,v.jsx)("div",{className:"py-8 text-center",children:(0,v.jsx)("p",{className:"text-textGray",children:0===b.length?"No services found. Click the + button to add your first service.":y||"all"!==(null===g||void 0===g?void 0:g.value)?"No services match your current filters.":"No services available."})}):(0,v.jsx)(n.Q1,{data:S,onEdit:e=>{console.log("Service data to edit:",e),u(e),t(!0)}})})]}),(0,v.jsx)(d.A,{isOpen:O,closeModal:()=>R(!1),title:"Add New Patient",children:(0,v.jsx)(m.A,{closeModal:()=>R(!1),onSuccess:e=>{_(),k(""),R(!1)}})})]})}}}]);