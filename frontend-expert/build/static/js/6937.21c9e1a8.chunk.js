"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[6937],{57939:()=>{},77515:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(89379),l=a(9950),r=a(87988),n=a.n(r),o=(a(67556),a(17340)),i=a(22535),c=a(42074),d=a(6604),m=a(89404),u=a(51667),x=a(36315),g=a(27358),h=a(58549),p=a(28429),f=a(68873),b=a(35887),j=a(44414);const v=()=>{const{id:e}=(0,p.g)(),[t,a]=(0,l.useState)([]),[r,n]=(0,l.useState)([]),[o,i]=(0,l.useState)(!0),[c,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)({currentPage:1,totalPages:1,totalUrls:0,limit:6}),x=l.useRef(null),g=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.currentPage;try{i(!0);const s=await fetch("".concat("","/doctor/medical-documents/").concat(e,"?page=").concat(t),{headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to fetch attachments")}const l=await s.json();a(l.urls||[]),u({currentPage:l.pagination.currentPage,totalPages:l.pagination.totalPages,totalUrls:l.pagination.totalUrls,limit:l.pagination.limit})}catch(s){console.error("Error fetching attachments:",s),b.Ay.error(s.message||"Failed to load images")}finally{i(!1)}};(0,l.useEffect)(()=>{g()},[e]);const h=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if(0===t.length)return void b.Ay.error("No files selected for upload");d(!0);const a=new FormData;t.forEach(e=>a.append("attachments",e)),a.append("patientId",e);try{const e=fetch("".concat("","/doctor/medical-documents/upload"),{method:"POST",body:a,credentials:"include"});b.Ay.promise(e,{loading:"Uploading ".concat(t.length," file(s)..."),success:"".concat(t.length," file(s) uploaded successfully!"),error:"Upload failed. Please try again."});const l=await e;if(!l.ok){const e=await l.json().catch(()=>({}));throw new Error(e.message||"Upload failed with status: ".concat(l.status))}await l.json();n([]),u(e=>(0,s.A)((0,s.A)({},e),{},{currentPage:1})),await g(1)}catch(l){console.error("Error uploading files:",l)}finally{d(!1)}},v=()=>{x.current&&x.current.click()},w=e=>{e>=1&&e<=m.totalPages&&e!==m.currentPage&&(u(t=>(0,s.A)((0,s.A)({},t),{},{currentPage:e})),g(e))};return(0,j.jsxs)("div",{className:"p-6 md:px-12",children:[(0,j.jsx)("input",{ref:x,type:"file",accept:"image/jpeg,image/png",multiple:!0,onChange:async e=>{const t=Array.from(e.target.files);e.target.value="";const a=t.filter(e=>!!["image/jpeg","image/png"].includes(e.type)&&(!(e.size>5242880)||(b.Ay.error("File ".concat(e.name," is too large. Maximum size is 5MB.")),!1)));a.length<t.length&&b.Ay.error("Only JPEG and PNG images under 5MB are accepted"),a.length>0&&(n(a),await h(a))},className:"hidden",disabled:c}),(0,j.jsx)("div",{className:"flex justify-end mb-6",children:(0,j.jsx)("button",{onClick:v,className:"rounded-lg bg-blue-500 px-4 py-2 text-white transition duration-300 hover:bg-blue-600 disabled:opacity-50 flex items-center gap-2",disabled:c,children:c?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f.PSR,{className:"animate-spin"}),"Uploading..."]}):"Upload Documents"})}),o?(0,j.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,j.jsx)(f.PSR,{className:"animate-spin text-4xl text-subMain"})}):(0,j.jsx)(j.Fragment,{children:0===t.length?(0,j.jsxs)("div",{className:"text-center py-12",children:[(0,j.jsx)("p",{className:"text-gray-400 text-lg",children:"No attachments found."}),(0,j.jsx)("button",{onClick:v,className:"mt-4 text-blue-500 hover:text-blue-700 underline",children:"Upload some documents"})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3",children:t.map((e,t)=>(0,j.jsxs)("div",{className:"block overflow-hidden rounded-xl bg-white shadow-md transition duration-300 hover:shadow-lg",children:[(0,j.jsx)("div",{className:"px-4 pt-4",children:(0,j.jsx)("img",{src:e,alt:"Attachment ".concat(t+1),className:"h-48 w-full rounded-md object-cover cursor-pointer",loading:"lazy",onClick:()=>window.open(e,"_blank"),onError:t=>{t.target.src="/placeholder-image.png",console.error("Failed to load image:",e)}})}),(0,j.jsxs)("div",{className:"p-4 pb-3",children:[(0,j.jsx)("p",{className:"truncate text-sm text-gray-700",children:e.split("/").pop()}),(0,j.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-500 hover:text-blue-700 underline",children:"Open in new tab"})]})]},t))}),m.totalPages>1&&(0,j.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-8",children:[(0,j.jsx)("button",{onClick:()=>w(m.currentPage-1),disabled:1===m.currentPage,className:"rounded bg-gray-200 px-3 py-1 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,j.jsxs)("span",{className:"mx-4 text-sm text-gray-600",children:["Page ",m.currentPage," of ",m.totalPages,"(",m.totalUrls," total images)"]}),(0,j.jsx)("button",{onClick:()=>w(m.currentPage+1),disabled:m.currentPage===m.totalPages,className:"rounded bg-gray-200 px-3 py-1 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]})};var w=a(38613),N=a(39174);const y=function(){const[e,t]=l.useState(!0),[a,s]=l.useState(i.rQ.bloodTypeFilter[0]);return l.useEffect(()=>{(async()=>{t(!0),await new Promise(e=>setTimeout(e,1e3)),t(!1)})()},[]),e?(0,j.jsx)("div",{className:"flex items-center justify-center h-screen w-full",children:(0,j.jsx)(f.PSR,{className:"animate-spin text-4xl text-subMain"})}):(0,j.jsx)("div",{className:"p-6 w-full max-w-3xl mx-auto bg-white rounded-md",children:(0,j.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,j.jsxs)("div",{className:"max-w-md w-full",children:[(0,j.jsx)("label",{className:"text-md font-semibold text-black mb-1 block",children:"Blood Group"}),(0,j.jsx)("div",{className:"pt-3 text-md font-semibold text-gray mb-1 block",children:(0,j.jsx)(w.l6,{selectedPerson:a,setSelectedPerson:s,datas:i.rQ.bloodTypeFilter,children:(0,j.jsxs)("div",{className:"flex items-center justify-between rounded-md border border-gray-300 p-3 text-sm text-gray-400",children:[null===a||void 0===a?void 0:a.name," ",(0,j.jsx)(N.nwe,{className:"text-lg"})]})})})]}),[{label:"Weight (kg)",placeholder:"60 kg"},{label:"Height (ft)",placeholder:"5.5 ft"},{label:"Pulse (heart beat/min)",placeholder:"Reading"},{label:"Temperature (\xb0F)",placeholder:"Reading"}].map((e,t)=>(0,j.jsxs)("div",{className:"max-w-md w-full",children:[(0,j.jsx)("label",{className:"text-md font-semibold text-black mb-1 block",children:e.label}),(0,j.jsx)("input",{type:"text",placeholder:e.placeholder,className:"w-full border border-gray-300 rounded-md p-3 text-sm"})]},t)),(0,j.jsxs)("div",{className:"max-w-md w-full",children:[(0,j.jsx)("label",{className:"text-md font-semibold text-black mb-1 block",children:"Blood Pressure (mmHg)"}),(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsx)("input",{type:"text",placeholder:"Systolic",className:"w-full border border-gray-300 rounded-md p-3 text-sm"}),(0,j.jsx)("span",{className:"self-center",children:"/"}),(0,j.jsx)("input",{type:"text",placeholder:"Diastolic",className:"w-full border border-gray-300 rounded-md p-3 text-sm"})]})]}),[{label:"Allergies",placeholder:"beans, nuts, etc."},{label:"Habits",placeholder:"Smoking, Drinking, etc."},{label:"Medical History",placeholder:"Diabetes, Malaria"}].map((e,t)=>(0,j.jsxs)("div",{className:"max-w-md w-full",children:[(0,j.jsx)("label",{className:"text-md font-semibold text-black mb-1 block",children:e.label}),(0,j.jsx)("textarea",{rows:2,placeholder:e.placeholder,className:"w-full border border-gray-300 rounded-md p-3 text-sm resize-none"})]},t)),(0,j.jsx)("div",{className:"mt-6 flex justify-center",children:(0,j.jsx)("div",{className:"w-[320px]",children:(0,j.jsx)(w.$n,{label:"Save Changes",className:"w-full py-1 text-sm",onClick:()=>b.oR.error("This feature is not available yet")})})})]})})};var S=a(26910),k=a(50384),P=a(54826),D=a(28504),A=a(21636);a(57939);const C=e=>{const[t,a]=(0,l.useState)([]),[s,r]=(0,l.useState)(""),[n,o]=(0,l.useState)(null),i=(0,l.useRef)(null),c=(0,l.useRef)(null),d=(0,l.useRef)(null),{doctor:m}=(0,D.S)(),u=e.id,x=null===m||void 0===m?void 0:m._id,[g,h]=(0,l.useState)(x),[p,f]=(0,l.useState)(1),[b,v]=(0,l.useState)(!0),[w,N]=(0,l.useState)(!1),[y,C]=(0,l.useState)(null),R=((0,l.useRef)(null),(0,l.useRef)(null)),E=((0,l.useRef)({}),async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const s=u;if(g&&s)try{N(!0);const l=await S.A.post("".concat("","/user/all/").concat(s,"?page=").concat(t,"&limit=10"),{senderId:g}),r=l.data.messages.map((t,a)=>({id:t._id,sender:t.senderId===g?m.fullName:e.patientName,text:t.message,image:t.image,timestamp:t.createdAt}));if(console.log("fetchedMessages:",r),r.length>0){const e=r[r.length-1];C(e.id)}a(1===t?r:e=>{const t=new Set(e.map(e=>e.id));return[...r.filter(e=>!t.has(e.id)),...e]}),v(t<l.data.pagination.totalPages),f(t)}catch(l){console.error("Error fetching messages",l)}finally{N(!1)}});(0,l.useEffect)(()=>{const e=()=>{const e=R.current;if(e&&!w&&b&&0===e.scrollTop){const t=e.scrollHeight;E(p+1).then(()=>{setTimeout(()=>{const a=e.scrollHeight;e.scrollTop=a-t},100)})}},t=R.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}},[p,w,b]),(0,l.useEffect)(()=>{g&&u&&(a([]),f(1),v(!0),E(1))},[g,u]);(0,l.useEffect)(()=>{(()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[t]);const M=[...t].sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp));return(0,j.jsxs)("div",{className:"flex h-[800px] w-full flex-col overflow-hidden bg-[#DBD9D940]",style:{scrollbarWidth:"none"},children:[(0,j.jsxs)("div",{className:"top-border",children:[(0,j.jsxs)("div",{className:"flex flex-row items-center",children:[(0,j.jsx)("h6",{className:"pl-4 text-[20px] text-[Gilroy-SemiBold] text-[black]",children:m.fullName}),(0,j.jsx)(P.Vr3,{className:"ml-4 h-[16px] w-[16px]"})]}),(0,j.jsx)("img",{src:m.doctorImage,className:"h-[40px] w-[40px] rounded-full"})]}),(0,j.jsxs)("div",{className:"message-container",style:{scrollbarWidth:"none"},ref:R,children:[M.map((e,t)=>{const a=new Date(e.timestamp),s=t>0?new Date(M[t-1].timestamp):null,r=!s||a.toDateString()!==s.toDateString();return(0,j.jsxs)(l.Fragment,{children:[r&&(0,j.jsx)("div",{className:"my-4 flex justify-center",children:(0,j.jsx)("span",{className:"rounded-full bg-gray-300 px-4 py-1 text-xs text-gray-700",children:(e=>{const t=new Date,a=new Date;return a.setDate(t.getDate()-1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===a.toDateString()?"Yesterday":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})(a)})}),(0,j.jsxs)("div",{className:"message ".concat(e.sender===m.fullName?"sent-message":"received-message"),children:[(0,j.jsx)("p",{className:"message-sender",children:e.sender}),(0,j.jsx)("p",{className:"message-text text-[14px] text-[Gilroy-Medium]",children:e.text}),e.image&&(0,j.jsxs)("div",{className:"relative mt-2 inline-block",children:[(0,j.jsx)("img",{src:e.image,alt:"Sent",className:"max-h-40 rounded-md"}),(0,j.jsx)("a",{href:e.image,download:"attachment-".concat(e.id),className:"absolute bottom-1 left-1 rounded-full bg-white p-1 shadow-md transition-opacity duration-200",title:"Download image",children:(0,j.jsx)(A.eCm,{className:"h-5 w-5 text-black"})})]}),(0,j.jsx)("div",{className:"flex w-full flex-row items-center justify-end",children:(0,j.jsx)("span",{className:"mr-8 text-[10px]",children:e.timestamp&&new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})})]})]},e.id)}),(0,j.jsx)("div",{ref:d})]}),(0,j.jsxs)("div",{className:"rouned-full flex w-full flex-row items-center justify-center border",children:[n&&(0,j.jsxs)("div",{className:"relative mb-2 ml-4 mt-2 w-fit",children:[(0,j.jsx)("img",{src:n,alt:"Preview",className:"max-h-40 rounded-md"}),(0,j.jsx)("button",{onClick:()=>o(null),className:"absolute left-1 top-1 rounded-full bg-red-600 p-1 text-white hover:bg-red-700",style:{fontSize:"12px",lineHeight:"12px"},title:"Remove file",children:"\u2715"})]}),(0,j.jsxs)("div",{className:"mb-8 flex w-[80%] flex-row items-center rounded-full bg-white p-2",children:[(0,j.jsx)("div",{className:"cursor-pointer",onClick:()=>c.current.click(),children:(0,j.jsx)(k.Mqx,{className:"h-[25px] w-[25px] text-black"})}),(0,j.jsx)("input",{ref:i,className:"input",placeholder:"Type a message...",value:s,onChange:e=>r(e.target.value)}),(0,j.jsx)("input",{type:"file",ref:c,style:{display:"none"},onChange:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onloadend=()=>{o(e.result)},e.readAsDataURL(t)}}}),(0,j.jsx)(k.JpO,{onClick:async()=>{if(!s.trim()&&!n)return;const e=(new Date).toISOString(),t=s.trim(),l={senderProfileId:x,receiverProfileId:u,message:t||"",image:n||null,timestamp:e};console.log("Data to be sent:",l),a(a=>[...a,{id:a.length+1,sender:m.fullName,text:t,image:n,timestamp:e}]),r(""),o(null);try{await S.A.post("".concat("","/user/send/").concat(u),{senderId:x,message:t||"",image:n||null})}catch(i){console.error("Error saving message:",i)}},className:"h-[25px] w-[25px] text-[#A3A3A3] cursor-pointer"})]})]})]})};const R=function(){var e,t;const[a,r]=l.useState(4),[f,w]=l.useState(!1),[S,k]=l.useState({}),{id:P}=(0,p.g)(),D=(0,p.Zp)(),[A,R]=l.useState(!0),E=(0,l.useRef)(null),[M,F]=(0,l.useState)(!1),[T,I]=(0,l.useState)(!1);(0,l.useEffect)(()=>{n().init({duration:1e3,once:!1}),n().refresh()},[a]),(0,l.useEffect)(()=>{P&&async function(){try{const e=await fetch("".concat("","/doctor/patient/").concat(P),{credentials:"include"}),t=await e.json();k((0,s.A)({},t))}catch(e){console.error("Failed to fetch patient data",e)}finally{R(!1)}}()},[P]);const U=async()=>{try{const e=await fetch("".concat("","/doctor/patient/").concat(P),{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok)b.oR.success("Patient deleted successfully"),D("/patients");else{const t=await e.json();b.oR.error(t.message||"Failed to delete patient")}}catch(e){console.error("Error deleting patient:",e),b.oR.error("Failed to delete patient")}};return(0,j.jsxs)(o.A,{children:[(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[(0,j.jsx)(c.N_,{to:"/patients",className:"text-md rounded-lg border border-dashed border-subMain bg-white px-4 py-3",children:(0,j.jsx)(d.$jz,{})}),(0,j.jsx)("h1",{className:"text-xl font-semibold",children:null===S||void 0===S?void 0:S.fullName})]}),1===a&&(0,j.jsx)("div",{onClick:()=>{w(!0)},className:"flex-colo button-fb fixed bottom-8 right-12 z-50 h-16 w-16 animate-bounce rounded-full border border-border bg-[#0095D9] cursor-pointer text-white",children:(0,j.jsx)(N.Ca6,{className:"text-2xl"})}),(0,j.jsxs)("div",{className:"my-8 grid grid-cols-12 items-start gap-6",children:[(0,j.jsxs)("div",{"data-aos":"fade-right",className:"top-28 col-span-12 flex-colo gap-6 rounded-xl border border-border bg-white p-6 lg:sticky lg:col-span-4",children:[(0,j.jsxs)("div",{onClick:()=>r(8),className:"".concat(8===a?"bg-text text-subMain":""," border-dashed border-text hover:bg-text hover:text-subMain cursor-pointer rounded-lg p-3 px-5 relative"),children:[(0,j.jsxs)("div",{className:"relative inline-block ml-5",children:[(0,j.jsx)("img",{src:null===S||void 0===S?void 0:S.userImage,alt:"Patient",className:"h-40 w-40 rounded-full border border-subMain object-cover mx-auto"}),(0,j.jsx)("button",{onClick:e=>{var t;e.stopPropagation(),null===(t=E.current)||void 0===t||t.click()},disabled:M,className:"absolute bottom-0 right-0 flex h-10 w-10 items-center justify-center rounded-full bg-subMain text-white shadow-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Add Profile Photo",children:M?(0,j.jsx)("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"}):(0,j.jsx)(N.Ca6,{className:"text-xl"})})]}),(0,j.jsxs)("div",{className:"flex-colo gap-2 mt-4",children:[(0,j.jsx)("h2",{className:"text-sm font-semibold",children:null===S||void 0===S?void 0:S.fullName}),(0,j.jsx)("p",{className:"text-xs text-textGray",children:null===S||void 0===S||null===(e=S.contactDetails)||void 0===e?void 0:e.email}),(0,j.jsx)("p",{className:"text-xs",children:null===S||void 0===S||null===(t=S.contactDetails)||void 0===t?void 0:t.primaryContact})]})]}),(0,j.jsx)("input",{type:"file",ref:E,accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void b.oR.error("Please select an image file");if(t.size>5242880)b.oR.error("Image size must be less than 5MB");else{F(!0);try{const e=new FormData;e.append("profileImage",t);const a=await fetch("".concat("","/doctor/patient/upload-profile-photo/").concat(P),{method:"POST",body:e,credentials:"include"}),l=await a.json();a.ok?(b.oR.success("Profile photo uploaded successfully!"),k((0,s.A)((0,s.A)({},S),{},{userImage:l.imageUrl}))):b.oR.error(l.message||"Failed to upload profile photo")}catch(a){console.error("Error uploading profile photo:",a),b.oR.error("Something went wrong. Please try again.")}finally{F(!1),E.current&&(E.current.value="")}}},className:"hidden"}),(0,j.jsx)("div",{className:"flex flex-col items-center gap-3 w-80",children:i.rj.map((e,t)=>(0,j.jsxs)("button",{onClick:()=>r(e.id),className:"".concat(a===e.id?"bg-text text-subMain":"bg-dry text-main hover:bg-text hover:text-subMain"," flex w-75 items-center gap-4 rounded-lg px-5 py-3 text-xs"),children:[(0,j.jsx)(e.icon,{className:"text-lg"})," ",e.title]},t))})]}),(0,j.jsx)("div",{"data-aos":"fade-left",className:"col-span-12 rounded-xl border border-border bg-white p-6 lg:col-span-8",children:(()=>{switch(a){case 1:return(0,j.jsx)(y,{});case 2:return(0,j.jsx)(u.A,{doctor:!1});case 3:return(0,j.jsx)(v,{});case 4:return(0,j.jsx)(m.A,{isMRMO:f,setIsMRMO:w,patient:S});case 5:return(0,j.jsx)(C,{patientName:null===S||void 0===S?void 0:S.fullName,id:P});case 6:return(0,j.jsx)(g.A,{doctor:!1,patientName:null===S||void 0===S?void 0:S.fullName});case 7:return(0,j.jsx)(x.A,{});case 8:return(0,j.jsx)(h.A,{titles:!1,data:S,onDelete:U,showDeleteConfirm:T,setShowDeleteConfirm:I});default:return null}})()})]})]})}}}]);