"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[4667],{11827:(e,t,s)=>{s.d(t,{A:()=>i});s(9950);var n=s(35887),a=s(58549),o=s(44414);const i=function(e){let{closeModal:t,onSuccess:s}=e;return(0,o.jsx)("div",{className:"",children:(0,o.jsx)("div",{"data-aos":"fade-up","data-aos-duration":"1000","data-aos-delay":"100","data-aos-offset":"200",className:" bg-white px-6",children:(0,o.jsx)(a.A,{titles:!0,isModal:!0,onSave:async e=>{try{const t=await fetch("".concat("","/doctor/patients/create"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),a=await t.json();t.ok?(n.oR.success(a.message||"Patient created successfully!"),s&&s(a.data||e)):n.oR.error((null===a||void 0===a?void 0:a.message)||"Failed to create patient")}catch(t){console.error(t),n.oR.error("Something went wrong. Please try again.")}},closeModal:t})})})}},38205:(e,t,s)=>{s.d(t,{A:()=>i});var n=s(39174),a=s(28429),o=s(44414);const i=function(e){let{onActionClick:t}=e;const s={"/patients":"Add Patient","/appointments":"New Appointment","/payments":"Add Payment","/services":"Add Service"}[(0,a.zy)().pathname];return s?(0,o.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-[#0095D9] to-[#0078B3] text-white font-medium hover:shadow-lg transform hover:scale-105 transition-all duration-200",title:s,children:[(0,o.jsx)(n.Ca6,{className:"text-lg"}),(0,o.jsx)("span",{className:"text-sm",children:s})]}):null}},79357:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var n=s(9950),a=s(17340),o=s(61268),i=s(59051),l=s.n(i),r=s(39174),d=s(99324),c=s(72676),m=s(7248),u=s(22535),p=s(54826),x=s(61533),h=s(28429),v=(s(73422),s(28504)),f=s(21386),g=s(11827),w=s(58644),b=s(50384),j=s(31222),y=s(38205),N=s(44414);const A=e=>{const{setCurrentView:t,onNavigate:s,onView:n}=e,a=()=>{n&&n("month")},o=()=>{n&&n("week")},i=()=>{n&&n("day")},m=()=>{t("list")};return(0,N.jsx)("div",{className:"mb-8 flex flex-col gap-8",children:(0,N.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-12",children:[(0,N.jsx)("div",{className:"flex items-center justify-center sm:justify-start md:col-span-1",children:(0,N.jsx)("button",{onClick:()=>{s&&s("TODAY")},className:"rounded-md border border-subMain px-6 py-2 text-subMain",children:"Today"})}),(0,N.jsxs)("div",{className:"flex-rows gap-4 md:col-span-9",children:[(0,N.jsx)("button",{onClick:()=>{s&&s("prev")},className:"text-2xl text-subMain",children:(0,N.jsx)(r.MQY,{})}),(0,N.jsx)("span",{className:"text-xl font-semibold",children:l()(e.date).format("MMMM YYYY")}),(0,N.jsx)("button",{onClick:()=>{s&&s("next")},className:"text-2xl text-subMain",children:(0,N.jsx)(r.XWt,{})})]}),(0,N.jsx)("div",{className:"grid grid-cols-4 rounded-md border border-subMain md:col-span-2",children:[{view:"list",label:"List"},{view:"month",label:"Month"},{view:"week",label:"Week"},{view:"day",label:"Day"}].map((t,s)=>(0,N.jsx)("button",{onClick:"month"===t.view?a:"week"===t.view?o:"list"===t.view?m:i,className:"flex-colo border-l border-subMain py-2 text-xl ".concat(e.view===t.view?"bg-subMain text-white":"text-subMain"),children:"month"===t.view?(0,N.jsx)(d.pkD,{}):"week"===t.view?(0,N.jsx)(c.xsd,{}):"list"===t.view?(0,N.jsx)(p.v5n,{}):(0,N.jsx)(r.FOv,{})},s))})]})})};const M=function(){const e=(0,o.ye)(l()),[t,s]=n.useState(!1),[i,d]=n.useState({}),[c,p]=n.useState([]),[M,S]=n.useState([]),[C,D]=n.useState(""),[k,O]=n.useState(!1),[T,V]=n.useState(!1),[Y,E]=n.useState({start:l()().startOf("month").toDate(),end:l()().endOf("month").toDate()}),[P,L]=n.useState(!0),[F,I]=n.useState([]),[R,_]=n.useState("list"),[z,B]=n.useState(new Date),H=(0,h.Zp)(),W=(0,v.S)(),G=()=>{s(!t),d({})},U=(0,n.useCallback)(async()=>{try{const e=l()(Y.start).utc().startOf("day").toISOString(),t=l()(Y.end).utc().endOf("day").toISOString(),s=await fetch("".concat("","/doctor/appointments?start=").concat(encodeURIComponent(e),"&end=").concat(encodeURIComponent(t)),{credentials:"include"}),n=await s.json();I([...n])}catch(e){console.error("Error fetching appointments:",e)}finally{L(!1)}},[Y.start,Y.end]);(0,n.useEffect)(()=>{U()},[U]),(0,n.useEffect)(()=>{if(null===W||void 0===W||!W._id)return;f.A.emit("registerUser",W._id);const e=e=>{U()};return f.A.on("appointment-update-received",e),()=>{f.A.off("appointment-update-received",e)}},[null===W||void 0===W?void 0:W._id,U]),(0,n.useEffect)(()=>{(async()=>{try{const e=await fetch("".concat("","/doctor/unique/patients"),{credentials:"include"}),t=await e.json();p(null===t||void 0===t?void 0:t.patients)}catch(e){console.log("Error fetching data:",e)}})()},[]);const X=async()=>{try{const e=await fetch("".concat("","/doctor/patients"),{credentials:"include"}),t=await e.json();S(t||[])}catch(e){console.log("Error fetching patients:",e)}};(0,n.useEffect)(()=>{X()},[]),(0,n.useEffect)(()=>{const e=()=>{G()};return window.addEventListener("action:addAppointment",e),()=>{window.removeEventListener("action:addAppointment",e)}},[]);const q=null===M||void 0===M?void 0:M.filter(e=>((null===e||void 0===e?void 0:e.title)||"").toLowerCase().includes(C.toLowerCase())),J=F.filter(e=>{var t;const s=null===(t=e.status)||void 0===t?void 0:t.toLowerCase(),n=["approved","cancelled","pending"].includes(s);return console.log("Appointment ".concat(e._id,': status="').concat(e.status,'" -> included=').concat(n)),n}).map((e,t)=>{u.XL.find(t=>t.name.toLowerCase()===e.purposeOfVisit.toLowerCase());const s=l()(e.startTime),n=l()(e.endTime),o=l()(e.dateOfVisit).format("YYYY-MM-DD"),i=l()("".concat(o,"T").concat(s.format("HH:mm:ss"))),r=l()("".concat(o,"T").concat(n.format("HH:mm:ss")));return P?(0,N.jsx)(a.A,{children:(0,N.jsx)("p",{children:"Loading..."})}):{id:t,start:i.toDate(),end:r.toDate(),color:"#FB923C",title:e.userId.fullName,patientId:e.userId._id,message:e.description||"No description provided",service:e.purposeOfVisit,shareData:e.shareWithPatient||{email:!1,sms:!1,whatsapp:!1},status:e.status,appointmentId:e._id,dateOfVisit:e.dateOfVisit}});console.log("Transformed events:",J);const K=e=>{d(e),s(!t)},Q={todayTotal:J.filter(e=>l()(e.dateOfVisit).isSame(l()(),"day")).length,monthTotal:J.filter(e=>l()(e.dateOfVisit).isSame(l()(),"month")).length,yearTotal:J.filter(e=>l()(e.dateOfVisit).isSame(l()(),"year")).length},Z=[{id:1,title:"Today Appointments",value:Q.todayTotal,color:["bg-subMain","text-subMain"],icon:r.FOv},{id:2,title:"Monthly Appointments",value:Q.monthTotal,color:["bg-pink-500","text-pink-500"],icon:b.Kh3},{id:3,title:"Yearly Appointments",value:Q.yearTotal,color:["bg-green-500","text-green-500"],icon:j.Wv5}];return(0,N.jsxs)(a.A,{children:[(0,N.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,N.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Appointments"})}),(0,N.jsxs)("div",{className:"relative flex justify-between items-center mb-6  grid-cols-1 gap-2 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-7",children:[(0,N.jsx)("input",{type:"text",placeholder:'Search "Patients"',className:"h-11 rounded-md border border-border bg-dry px-4 text-sm text-main md:col-span-2 lg:col-span-3",value:C,onChange:e=>{D(e.target.value),O(!0)},onBlur:()=>{setTimeout(()=>O(!1),150)},onFocus:()=>O(!0)}),(0,N.jsx)(y.A,{onActionClick:G}),k&&C&&(0,N.jsxs)("ul",{className:"absolute top-16 z-10 w-full max-w-xs rounded-md border border-gray-200 bg-white shadow-md md:col-span-2 lg:col-span-3",children:[(null===q||void 0===q?void 0:q.length)>0&&q.map((e,t)=>(0,N.jsxs)("li",{className:"flex cursor-pointer flex-row items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onMouseDown:t=>{t.preventDefault(),D((null===e||void 0===e?void 0:e.title)||""),O(!1),H("/patients/preview/".concat(null===e||void 0===e?void 0:e._id))},children:[(0,N.jsx)("img",{src:null===e||void 0===e?void 0:e.image,alt:"Patient",className:"h-10 w-10 rounded-full border border-subMain object-cover"}),(0,N.jsxs)("div",{className:"flex flex-col",children:[(0,N.jsx)("h2",{className:"text-sm font-semibold",children:null===e||void 0===e?void 0:e.title}),(0,N.jsx)("p",{className:"text-xs text-textGray",children:null===e||void 0===e?void 0:e.email}),(0,N.jsx)("p",{className:"text-xs",children:null===e||void 0===e?void 0:e.phone})]})]},t)),0===(null===q||void 0===q?void 0:q.length)&&(0,N.jsxs)("li",{className:"flex cursor-pointer items-center gap-2 px-4 py-2 text-sm text-main hover:bg-gray-100",onMouseDown:e=>{e.preventDefault(),V(!0)},children:[(0,N.jsx)("span",{className:"text-xl font-bold",children:"+"}),(0,N.jsxs)("span",{children:['Add "',C,'" as new patient']})]})]})]}),t&&(0,N.jsx)(m.A,{datas:i,isOpen:t,patientData:c,closeModal:G,onSuccess:()=>{U()}}),(0,N.jsx)(A,{date:z,view:R,onNavigate:e=>{"prev"===e?B(e=>{const t=new Date(e);return t.setMonth(t.getMonth()-1),t}):"next"===e?B(e=>{const t=new Date(e);return t.setMonth(t.getMonth()+1),t}):"TODAY"===e&&B(new Date)},onView:e=>{_("list"===e?"list":e)},setCurrentView:_}),(0,N.jsx)("div",{className:"mt-8 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3",children:Z.map(e=>(0,N.jsxs)("div",{className:"flex-btn gap-4 rounded-xl border border-border bg-white p-4",children:[(0,N.jsxs)("div",{className:"w-3/4",children:[(0,N.jsx)("h2",{className:"text-md font-medium",children:e.title}),(0,N.jsx)("h2",{className:"font-small my-3 text-sm",children:e.value}),(0,N.jsxs)("p",{className:"text-xs",children:["Total Appointments"," ",(0,N.jsx)("span",{className:"".concat(e.color[1]," font-bold"),children:e.value})," ","Today Appointments"===e.title?"today":"Monthly Appointments"===e.title?"this month":"this year"]})]}),(0,N.jsx)("div",{className:"flex-colo text-md h-10 w-10 rounded-full text-white ".concat(e.color[0]),children:(0,N.jsx)(e.icon,{className:"text-xl"})})]},e.id))}),(0,N.jsx)("div",{className:"mb-12 mt-8 h-[550px] sm:h-[600px] lg:h-[900px]",children:"list"===R?(0,N.jsx)(x.hs,{data:J,onSelectEvent:K}):(0,N.jsx)(o.Vv,{localizer:e,events:J,startAccessor:"start",endAccessor:"end",style:{height:"100%",marginBottom:50},onSelectEvent:K,date:z,view:R,timeslots:1,resizable:!0,step:60,selectable:!0,eventPropGetter:e=>({style:{backgroundColor:"#66B5A3",borderRadius:"10px",color:"white",border:"1px solid #F2FAF8",fontSize:"12px",padding:"5px 5px"}}),dayPropGetter:()=>({style:{backgroundColor:"white"}}),views:["month","day","week"],components:{toolbar:()=>null},onRangeChange:e=>{Array.isArray(e)?E({start:e[0],end:e[e.length-1]}):"object"===typeof e&&e.start&&e.end&&E({start:e.start,end:e.end})},onNavigate:e=>{"prev"===e?B(e=>{const t=new Date(e);return t.setMonth(t.getMonth()-1),t}):"next"===e?B(e=>{const t=new Date(e);return t.setMonth(t.getMonth()+1),t}):"TODAY"===e&&B(new Date)},onView:e=>{_(e)}})}),(0,N.jsx)(w.A,{isOpen:T,closeModal:()=>V(!1),title:"Add New Patient",children:(0,N.jsx)(g.A,{closeModal:()=>V(!1),onSuccess:e=>{D(""),V(!1),X()}})})]})}}}]);