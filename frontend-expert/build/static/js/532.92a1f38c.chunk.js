"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[532],{11827:(e,t,a)=>{a.d(t,{A:()=>i});a(9950);var n=a(35887),s=a(58549),o=a(44414);const i=function(e){let{closeModal:t,onSuccess:a}=e;return(0,o.jsx)("div",{className:"",children:(0,o.jsx)("div",{"data-aos":"fade-up","data-aos-duration":"1000","data-aos-delay":"100","data-aos-offset":"200",className:" bg-white px-6",children:(0,o.jsx)(s.A,{titles:!0,isModal:!0,onSave:async e=>{try{const t=await fetch("".concat("","/doctor/patients/create"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),s=await t.json();t.ok?(n.oR.success(s.message||"Patient created successfully!"),a&&a(s.data||e)):n.oR.error((null===s||void 0===s?void 0:s.message)||"Failed to create patient")}catch(t){console.error(t),n.oR.error("Something went wrong. Please try again.")}},closeModal:t})})})}},18798:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var n=a(9950),s=a(17340),o=a(22535),i=a(28429),l=a(39174),r=a(50384),c=a(31222),d=a(26678),m=a(35887),p=a(38613),u=a(61533),x=a(11827),h=a(58644),g=a(38205),v=a(44414);const f=function(){const[e,t]=(0,n.useState)(o.rQ.filterPatient[0].name||"All"),[a,f]=(0,n.useState)(o.rQ.genderFilter[0].name||"All"),[y,w]=(0,n.useState)([]),[b,j]=(0,n.useState)([null,null]),[N,S]=(0,n.useState)(""),[A,P]=(0,n.useState)({todayTotal:0,monthTotal:0,yearTotal:0}),[D,R]=(0,n.useState)(!1),[M,T]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1),[E,L]=b,O=null===y||void 0===y?void 0:y.filter(e=>e.title.toLowerCase().includes(N.toLowerCase())),F=(0,i.Zp)(),U=async()=>{try{const e=await fetch("".concat("","/doctor/patients"),{credentials:"include"}),t=await e.json();w(t)}catch(e){console.error("Error fetching patients:",e)}finally{R(!1)}},B=async()=>{try{const t=new URLSearchParams;if(null!==N&&void 0!==N&&N.trim()&&t.append("search",N.trim()),a&&"Gender"!==a&&"All"!==a&&t.append("gender",a),e&&("Newest Patients"===e?t.append("sortBy","newest"):"Oldest Patients"===e&&t.append("sortBy","oldest")),E&&L){const e=new Date(E);e.setHours(0,0,0,0);const a=new Date(L);a.setHours(23,59,59,999),t.append("fromDate",e.toISOString()),t.append("toDate",a.toISOString())}const n=await fetch("".concat("","/doctor/patients/filter?").concat(t.toString()),{credentials:"include"}),s=await n.json();w(s)}catch(t){console.error("Error fetching filtered patients:",t)}finally{R(!1)}};(0,n.useEffect)(()=>{(async()=>{try{const e=await fetch("".concat("","/doctor/patients/stats"),{credentials:"include"}),t=await e.json();P(t)}catch(e){console.error("Error fetching patient stats:",e)}finally{R(!1)}})()},[]),(0,n.useEffect)(()=>{B()},[]),(0,n.useEffect)(()=>{const e=setTimeout(()=>{B()},350);return()=>clearTimeout(e)},[N,a,e,E,L]),(0,n.useEffect)(()=>{U()},[]),(0,n.useEffect)(()=>{const e=()=>{k(!0)};return window.addEventListener("action:addPatient",e),()=>{window.removeEventListener("action:addPatient",e)}},[]);const I=[{id:2,selected:e,setSelected:t,datas:o.rQ.filterPatient},{id:3,selected:a,setSelected:f,datas:o.rQ.genderFilter}],_=[{id:1,title:"Today Patients",value:null===A||void 0===A?void 0:A.todayTotal,color:["bg-subMain","text-subMain"],icon:l.FOv},{id:2,title:"Monthly Patients",value:null===A||void 0===A?void 0:A.monthTotal,color:["bg-pink-500","text-pink-500"],icon:r.Kh3},{id:3,title:"Yearly Patients",value:null===A||void 0===A?void 0:A.yearTotal,color:["bg-green-500","text-green-500"],icon:c.Wv5}];return(0,v.jsxs)(s.A,{children:[C&&(0,v.jsx)(h.A,{isOpen:C,closeModal:()=>k(!1),title:"Add Patient",width:"max-w-4xl",showCloseButton:!1,children:(0,v.jsx)(x.A,{closeModal:()=>k(!1),onSuccess:e=>{U(),k(!1)}})}),(0,v.jsx)("div",{className:"relative mb-6 grid grid-cols-1 gap-2 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-7",children:(0,v.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Patients"})}),(0,v.jsxs)("div",{className:"mb-4 mt-8 flex items-center justify-between",children:[(0,v.jsx)("input",{type:"text",placeholder:'Search "Patients"',className:"h-11 rounded-md border border-border bg-dry px-4 text-sm text-main md:col-span-2 lg:col-span-3",value:N,onChange:e=>{S(e.target.value),T(!0)},onBlur:()=>{setTimeout(()=>T(!1),150)},onFocus:()=>T(!0)}),M&&N&&(0,v.jsxs)("ul",{className:"absolute top-16 z-10 w-full max-w-xs rounded-md border border-gray-200 bg-white shadow-md md:col-span-2 lg:col-span-3",children:[O.length>0&&O.map((e,t)=>(0,v.jsxs)("li",{className:"flex cursor-pointer flex-row items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onMouseDown:t=>{t.preventDefault(),S(e.title),T(!1),F("/patients/preview/".concat(e._id))},children:[(0,v.jsx)("img",{src:null===e||void 0===e?void 0:e.image,alt:"Patient",className:"h-10 w-10 rounded-full border border-subMain object-cover"}),(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)("h2",{className:"text-sm font-semibold",children:null===e||void 0===e?void 0:e.title}),(0,v.jsx)("p",{className:"text-xs text-textGray",children:null===e||void 0===e?void 0:e.email}),(0,v.jsx)("p",{className:"text-xs",children:null===e||void 0===e?void 0:e.phone})]})]},t)),0===O.length&&(0,v.jsxs)("li",{className:"flex cursor-pointer items-center gap-2 px-4 py-2 text-sm text-main hover:bg-gray-100",onMouseDown:e=>{e.preventDefault(),k(!0)},children:[(0,v.jsx)("span",{className:"text-xl font-bold",children:"+"}),(0,v.jsxs)("span",{children:['Add "',N,'" as new patient']})]})]}),(0,v.jsxs)("div",{className:"flex items-center gap-3",children:[(0,v.jsx)(g.A,{onActionClick:()=>k(!0)}),(0,v.jsxs)("button",{onClick:async()=>{try{if(!y||0===y.length)return void m.oR.error("No data to export");m.oR.loading("Preparing comprehensive export... This may take a moment.");const e=await Promise.all(y.map(async e=>{var t;const a=e._id||(null===(t=e.userId)||void 0===t?void 0:t._id);try{const t=await fetch("".concat("","/doctor/medical-records/").concat(a),{credentials:"include"}),n=(t.ok?await t.json():{data:[]}).data||[],s=await fetch("".concat("","/doctor/user/appointments?userId=").concat(a),{credentials:"include"}),o=s.ok?await s.json():[],i=await fetch("".concat("","/doctor/patient/payments/").concat(a),{credentials:"include"});return{patient:e,medicalRecords:n,appointments:o,payments:i.ok?await i.json():[]}}catch(n){return console.error("Error fetching data for patient ".concat(a,":"),n),{patient:e,medicalRecords:[],appointments:[],payments:[]}}}));m.oR.dismiss(),m.oR.loading("Generating CSV file...");const t=[],a=[...["Patient ID","Patient Name","Email","Phone","Gender","Age","Blood Group","UHID","Address","Date Registered","Total Appointments","Medical Records Count","Appointments Count","Payments Count","Total Payments Amount"],...["Medical Record Date","Medical Record Complaints","Medical Record Symptoms","Medical Record Diagnosis","Medical Record Medications","Medical Record Notes","Medical Record Follow Up"],...["Appointment Date","Appointment Time","Appointment Status","Appointment Purpose","Appointment Description"],...["Payment Date","Payment Amount","Payment Status","Payment Method","Payment Description"]];t.push(a.join(",")),e.forEach(e=>{let{patient:a,medicalRecords:n,appointments:s,payments:o}=e;const i=Math.max(n.length,s.length,o.length,1),l=o.reduce((e,t)=>e+(parseFloat(t.amount)||0),0);for(let x=0;x<i;x++){var r,c,d,m,p,u;const e=n[x]||{},i=s[x]||{},h=o[x]||{},g=(null===(r=e.complaints)||void 0===r?void 0:r.map(e=>e.name).join("; "))||"",v=(null===(c=e.symptoms)||void 0===c?void 0:c.map(e=>e.name).join("; "))||"",f=(null===(d=e.diagnosis)||void 0===d?void 0:d.map(e=>e.name).join("; "))||"",y=(null===(m=e.medications)||void 0===m?void 0:m.map(e=>e.name).join("; "))||"",w=e.notesForPatient||"",b=(null===(p=e.followUp)||void 0===p?void 0:p.date)||"",j=i.dateOfVisit||"",N=i.startTime&&i.endTime?"".concat(new Date(i.startTime).toLocaleTimeString()," - ").concat(new Date(i.endTime).toLocaleTimeString()):"",S=i.status||"",A=i.purposeOfVisit||"",P=i.description||"",D=h.createdAt?new Date(h.createdAt).toLocaleDateString():"",R=h.amount||"",M=h.status||"",T=h.paymentMethod||"",C=h.description||h.notes||"",k=[a._id||"",a.title||a.fullName||"",a.email||"",a.phone||(null===(u=a.contactDetails)||void 0===u?void 0:u.primaryContact)||"",a.gender||"",a.age||"",a.blood||"",a.uhid||"",a.address||"",a.date||"",a.totalAppointments||s.length||"",n.length,s.length,o.length,l.toFixed(2),(0===x||e)&&e.createdAt?new Date(e.createdAt).toLocaleDateString():"",0===x||e?g:"",0===x||e?v:"",0===x||e?f:"",0===x||e?y:"",0===x||e?w:"",0===x||e?b:"",i?j:"",i?N:"",i?S:"",i?A:"",i?P:"",h?D:"",h?R:"",h?M:"",h?T:"",h?C:""].map(e=>{const t=String(e||"");return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t});t.push(k.join(","))}t.push("")});const n=t.join("\n"),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),i=URL.createObjectURL(s);o.setAttribute("href",i);const l=(new Date).toISOString().split("T")[0];o.setAttribute("download","patients_comprehensive_export_".concat(l,".csv")),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),m.oR.dismiss(),m.oR.success("Exported ".concat(y.length," patients with all data to CSV"))}catch(e){console.error("Export error:",e),m.oR.dismiss(),m.oR.error("Failed to export data")}},className:"flex items-center gap-2 rounded-lg border border-subMain bg-white px-4 py-2 text-sm text-subMain transition-colors hover:bg-subMain hover:text-white",children:[(0,v.jsx)(d.a4D,{})," Export CSV"]})]})]}),(0,v.jsx)("div",{className:"mt-8 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3",children:_.map(e=>(0,v.jsxs)("div",{className:"flex-btn gap-4 rounded-xl border-[1px] border-border bg-white p-4",children:[(0,v.jsxs)("div",{className:"w-3/4",children:[(0,v.jsx)("h2",{className:"text-md font-medium",children:e.title}),(0,v.jsx)("h2",{className:"font-small my-3 text-sm",children:e.value}),(0,v.jsxs)("p",{className:"text-xs",children:["Total Patients"," ",(0,v.jsx)("span",{className:"".concat(e.color[1]," font-bold"),children:e.value})," ","Today Patients"===e.title?"today":"Monthly Patients"===e.title?"this month":"this year"]})]}),(0,v.jsx)("div",{className:"flex-colo text-md h-10 w-10 rounded-full text-white ".concat(e.color[0]),children:(0,v.jsx)(e.icon,{className:"text-xl"})})]},e.id))}),(0,v.jsxs)("div",{className:"my-8 rounded-xl border-[1px] border-border bg-white p-5",children:[(0,v.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[I.map(e=>(0,v.jsx)("div",{className:"w-full",children:(0,v.jsx)(p.l6,{selectedPerson:e.selected||{name:"All"},setSelectedPerson:e.setSelected,datas:e.datas||[],children:(0,v.jsxs)("div",{className:"flex h-14 w-full items-center justify-between rounded-md border border-border bg-dry px-4 text-xs font-medium text-black",children:[(0,v.jsx)("p",{children:e.selected||"All"}),(0,v.jsx)(l.nwe,{className:"text-xl"})]})})},e.id)),(0,v.jsxs)("div",{className:"relative w-full",children:[!E&&!L&&(0,v.jsx)("span",{className:"pointer-events-none absolute left-4 top-4 z-10 mt-2 text-xs text-gray-400",children:"Date Range"}),(0,v.jsx)(p.Yf,{startDate:E,endDate:L,bg:"bg-dry",onChange:e=>j(e),className:"w-full text-xs font-medium text-black"})]})]}),(0,v.jsx)("div",{className:"mt-8 w-full overflow-x-scroll",children:(0,v.jsx)(u.c2,{data:y,functions:{preview:e=>{F("/patients/preview/".concat(e))}},used:!1})})]})]})}},38205:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(39174),s=a(28429),o=a(44414);const i=function(e){let{onActionClick:t}=e;const a={"/patients":"Add Patient","/appointments":"New Appointment","/payments":"Add Payment","/services":"Add Service"}[(0,s.zy)().pathname];return a?(0,o.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-[#0095D9] to-[#0078B3] text-white font-medium hover:shadow-lg transform hover:scale-105 transition-all duration-200",title:a,children:[(0,o.jsx)(n.Ca6,{className:"text-lg"}),(0,o.jsx)("span",{className:"text-sm",children:a})]}):null}}}]);